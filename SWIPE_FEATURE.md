# 右滑删除功能说明

## 功能概述

实现了类似iOS邮件应用的右滑删除功能，用户可以通过右滑手势删除不感兴趣的内容条目，被删除的条目会被记录到Redis，下次刷新时自动过滤。

## 技术实现

### 1. 后端API

#### `/api/dismiss-item` - 记录已删除条目

**POST** - 标记条目为已滑掉
```typescript
body: {
  itemId: string
}
```

**GET** - 获取所有已滑掉的条目ID列表

**DELETE** - 清空所有已滑掉的条目（用于测试）

#### 数据存储

- 使用Redis的`SET`数据结构存储已滑掉的条目ID
- Key: `dismissed_items`
- 数据持久化到Redis，跨会话保持

### 2. 自动过滤

修改了 `/api/scrape` API，在返回数据前自动过滤已滑掉的条目：

1. 从Redis读取已滑掉的ID列表
2. 过滤所有数据源（强制刷新、定时更新、缓存读取）
3. 只返回未被滑掉的条目

### 3. 前端交互

#### ContentCard 组件

- 支持触摸滑动（移动端）和鼠标拖动（PC端）
- 滑动阈值：120px
- 视觉反馈：
  - 0-120px: 青色箭头 "→ 继续滑动"
  - >120px: 红色删除图标 "🗑️ 松手删除"
- 动画效果：
  - 滑动时实时跟随
  - 达到阈值后滑出屏幕
  - 未达阈值时回弹

#### 交互流程

1. 用户右滑条目 > 120px
2. 前端立即从列表中移除
3. 调用 `/api/dismiss-item` 记录到Redis
4. 自动尝试加载下一条数据补充

## 使用方式

### 移动端
- 在任意条目上向右滑动
- 滑动超过屏幕宽度的1/3即可删除

### PC端
- 按住鼠标左键向右拖动
- 拖动超过120px后松开鼠标

## 功能特性

✅ **智能过滤** - 下次刷新自动过滤已删除条目  
✅ **跨会话保持** - Redis持久化存储  
✅ **自动补充** - 删除后自动加载新内容  
✅ **视觉反馈** - 实时显示滑动状态  
✅ **双端支持** - 触摸和鼠标都支持  
✅ **防误触** - 区分水平滑动和垂直滚动  

## 测试方法

### 1. 测试滑动删除
```bash
# 在浏览器中右滑任意条目
# 查看控制台输出：🗑️ 滑掉条目: xxx
# 查看控制台输出：✅ 条目 xxx 已记录为已滑掉
```

### 2. 测试过滤功能
```bash
# 刷新页面
# 之前滑掉的条目不会再出现
```

### 3. 查看已滑掉的条目
```bash
curl http://localhost:3000/api/dismiss-item
```

### 4. 清空已滑掉的条目
```bash
curl -X DELETE http://localhost:3000/api/dismiss-item
```

## 文件修改

### 新增文件
- `app/api/dismiss-item/route.ts` - 删除条目API
- `SWIPE_FEATURE.md` - 功能说明文档

### 修改文件
- `app/api/scrape/route.ts` - 添加自动过滤逻辑
- `components/ContentCard.tsx` - 添加滑动手势检测
- `components/ContentList.tsx` - 添加onDismiss回调
- `app/page.tsx` - 添加handleDismiss处理函数

## 性能考虑

- Redis SET 操作时间复杂度 O(1)
- 过滤操作时间复杂度 O(n)，n为条目数量
- 前端动画使用 transform，GPU加速
- 避免不必要的重新渲染

## 未来改进

- [ ] 添加撤销功能（5秒内可撤销）
- [ ] 支持左滑收藏功能
- [ ] 定期清理过期的已滑掉条目
- [ ] 添加统计功能（已滑掉多少条）
